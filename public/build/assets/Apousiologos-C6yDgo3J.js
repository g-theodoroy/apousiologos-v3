import{f as i,v as n,c as g,o as v,b as a,t as b,d as q,r as P,g as w,n as l,h as B,e as C,i as F,j as te,C as re,k as oe,W as ae,a as d,u as m,m as le,w as H,F as I,l as U,p as ie,P as E,q as $,s as ne}from"./app-B-cmbjvL.js";import{_ as ue}from"./AppLayout.vue_vue_type_script_setup_true_lang-PEPtDQ3f.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ce}from"./Input.vue_vue_type_script_setup_true_lang-CyUlp5Kt.js";import{_ as D}from"./Checkbox.vue_vue_type_script_setup_true_lang-CcG7xGwb.js";import{_ as pe}from"./GthSuccess.vue_vue_type_script_setup_true_lang-kvLgG3Gb.js";import{_ as me}from"./GthError.vue_vue_type_script_setup_true_lang-BLuSXH5t.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CzG4im2e.js";import"./RovingFocusGroup-2U8FBijs.js";import"./useForwardExpose-CZ06Ebnk.js";const de={emits:["unlockHours","apouSubmit"],props:{showTitleAndButtons:Boolean,selectedTmima:String,checkIfInProgram:Boolean,canUnlockHours:Boolean,canSave:Boolean,checkIfAllowWeekends:Boolean},setup(A){return{}}},fe={class:"text-center flex flex-col sm:flex-row"},ve={class:"w-full text-center font-bold py-4"},he={class:"w-full text-center font-bold py-4"},ge={class:"text-center space-y-1 py-2 sm:space-y-0 sm:space-x-2 md:pl-20 w-full"};function we(A,r,c,p,o,y){return i((v(),g("div",fe,[a("div",ve,b(c.selectedTmima=="0"?"Ολα τα τμήματα":"Τμημα "+c.selectedTmima),1),i(a("div",he," Εκτός ωραρίου ",512),[[n,!c.checkIfInProgram]]),i(a("div",ge,[i(a("button",{onClick:r[0]||(r[0]=k=>A.$emit("unlockHours")),class:"gth"}," Ξεκλείδωμα ",512),[[n,c.canUnlockHours]]),i(a("button",{onClick:r[1]||(r[1]=k=>A.$emit("apouSubmit")),class:"gth"}," Αποθήκευση ",512),[[n,c.canSave]])],512),[[n,c.checkIfInProgram&&c.checkIfAllowWeekends]])],512)),[[n,c.showTitleAndButtons]])}const M=R(de,[["render",we],["__scopeId","data-v-7994b72e"]]),ke={key:0,class:"w-full"},be=["innerHTML"],ye={key:1,class:"w-full"},L=q({__name:"GthInfo",props:{property:{},message:{},html:{}},setup(A){const r=A,c=P(!1),p=P(null),o=P(null);p.value=w(()=>{let h=r.property?l().props.flash.message&&l().props.flash.message[r.property]:l().props.flash.message;return r.message&&(h=r.message),h&&(y(),o.value=setTimeout(k,5e3)),h});function y(){c.value=!0}function k(){c.value=!1}function S(){clearTimeout(o.first)}function _(){o.second=setTimeout(k,1e3)}return(h,f)=>p.value.value&&c.value?(v(),g("div",{key:0,class:"fixed top-4 left-1/2 transform -translate-x-1/2 p-4 text-center w-full max-w-max bg-blue-700 hover:cursor-pointer text-white rounded-lg flex flex-col sm:flex-row sm:justify-center",onClick:f[0]||(f[0]=x=>k()),onMouseenter:f[1]||(f[1]=x=>S()),onMouseleave:f[2]||(f[2]=x=>_())},[f[4]||(f[4]=a("div",{class:"font-semibold pr-2"},"Ενημέρωση:",-1)),h.html?(v(),g("div",ke,[a("span",{innerHTML:p.value.value},null,8,be),f[3]||(f[3]=C()),F(h.$slots,"default")])):B("",!0),h.html?B("",!0):(v(),g("div",ye,[C(b(p.value.value)+" ",1),F(h.$slots,"default")]))],32)):B("",!0)}}),Te={class:"max-w-7xl mx-auto px-4"},$e={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ae={class:"p-4 bg-white border-b border-gray-200 space-y-4"},Se={class:"flex flex-wrap border border-gray-200 rounded-md p-4"},He={class:"flex justify-center space-x-2"},Ce=["href"],xe={class:"text-center font-semibold text-3xl text-gray-700 py-2"},Ie={class:"flex flex-col rounded-md max-w-3xl mx-auto"},_e={class:"text-center font-semibold text-3xl text-gray-700 py-24"},Ue={class:"text-center font-semibold text-3xl text-gray-700 py-24"},Ee={class:"pt-1 flex flex-col sm:flex-row sm:space-x-2"},Pe={class:"flex space-x-2 sm:w-3/5 pt-3 font-semibold"},Ve={class:"w-6 text-center"},Be={class:"flex w-max justify-evenly border-2 border-gray-300 p-1 rounded-md self-center"},De=["onClick","title"],We={class:"flex space-x-2 sm:w-3/5 pt-3"},Oe={class:"w-6 text-right"},Ne={class:"w-10"},je={class:"flex w-max justify-evenly border-2 border-gray-300 p-1 rounded-md self-center"},Fe=["onClick","title"],Me=["onClick"],Le=["onClick"],qe=q({__name:"Apousiologos",props:{anatheseis:{},date:{},selectedTmima:{},setCustomDate:{},arrStudents:{},arrSendEmail:{},activeHour:{},totalHours:{},hoursUnlocked:{},letTeachersUnlockHours:{},allowTeachersEditOthersApousies:{},showFutureHours:{},isWeekend:{},allowWeekends:{},allowTeachersSaveAtNotActiveHour:{},allowTeachersEmail:{},arrApousies:{},arrNames:{},allowPastDays:{},isToday:{}},setup(A){const r=A,c=te(r.arrSendEmail),p=P(r.hoursUnlocked),o=re(r.arrApousies),y=w(function(){return!!(l().props.auth.user.permissions.admin||r.isWeekend!==1||r.isWeekend==1&&r.allowWeekends==1)}),k=w(function(){return!!(l().props.auth.user.permissions.admin&&r.arrStudents.length||r.selectedTmima!=="0")}),S=w(function(){return!!(l().props.auth.user.permissions.admin||r.activeHour||r.allowTeachersSaveAtNotActiveHour==1||r.allowPastDays&&o.date!==new Date().toISOString().split("T")[0])}),_=w(function(){return!!(r.letTeachersUnlockHours&&!p.value||r.allowPastDays&&o.date!==new Date().toISOString().split("T")[0]&&!p.value)}),h=w(function(){return!!(l().props.auth.user.permissions.admin||r.activeHour||r.allowTeachersSaveAtNotActiveHour&&p.value||r.allowPastDays&&o.date!==new Date().toISOString().split("T")[0]&&p.value)}),f=w(function(){return!!(r.selectedTmima!=="0"||l().props.auth.user.permissions.admin&&r.arrStudents.length)}),x=w(function(){return!!(r.selectedTmima=="0"&&l().props.auth.user.permissions.admin)}),W=w(function(){return!!(l().props.auth.user.permissions.admin||r.showFutureHours==1||!r.activeHour)}),O=w(function(){let e=0,t=!1;return r.arrStudents.forEach(s=>{e+=s.apousies,s.apousies&&s.email&&(t=!0)}),!!(l().props.auth.user.permissions.admin&&e&&t)}),z=w(function(){return!!(l().props.auth.user.permissions.admin||l().props.auth.user.permissions.teacher&&r.allowTeachersEmail==1&&r.isToday)});function N(){o.post(route("apousies.store")+`/${r.selectedTmima}/${r.date}`,{preserveScroll:!0})}function G(e){if(!h||!p.value&&!r.activeHour||!p.value&&r.activeHour&&e!==r.activeHour)return;let t=!1;if(r.arrStudents.forEach(T=>{r.arrApousies[T.id].teach[e]!==""&&r.arrApousies[T.id].teach[e]!=l().props.auth.user.id&&(t=!0)}),l().props.auth.user.permissions.admin&&(t=!1),t)return;let s;r.arrStudents.forEach((T,u)=>{u==0&&(s=!o[T.id].apou[e]),o[T.id].apou[e]=s})}function Q(e){if(!l().props.auth.user.permissions.admin)return;let t;for(let s in o[e].apou)s==1&&(t=!o[e].apou[s]),o[e].apou[s]=t,o[e].teach[s]=l().props.auth.user.id,t==!1&&(o[e].apov[s]=t,o[e].teach[s]=null)}function J(e){if(!l().props.auth.user.permissions.admin)return;let t;for(let s in o[e].apov){if(s==1&&(t=!o[e].apov[s],t==!0&&!confirm("Θέλετε να καταχωρίσετε Αποβολή;")))return;o[e].apov[s]=t,t==!0&&(o[e].apou[s]=t,o[e].teach[s]=l().props.auth.user.id)}}function K(){return new Date().toLocaleTimeString()}function X(){let e="";return Object.keys(c).forEach(t=>{c[t]&&(e+=","+t)}),e?"?st="+e.replace(/(^,)/g,""):""}function Y(e){Object.keys(c).forEach(t=>{c[t]=e.checked}),e.title=e.checked?"Αποεπιλογή όλων":"Επιλογή όλων"}function Z(){return l().props.auth.user.permissions.admin?!1:!!(r.setCustomDate||!r.allowPastDays)}function j(e,t){return!(l().props.auth.user.permissions.admin||r.activeHour==t||p.value&&r.allowTeachersEditOthersApousies||p.value&&(!r.arrApousies[e].teach[t]||l().props.auth.user.id==r.arrApousies[e].teach[t]))}function ee(e,t){if(j(e,t)!=!0)if(o[e].apov[t]==!1){if(!confirm("Θέλετε να καταχωρίσετε Αποβολή;"))return;o[e].apou[t]=!0,o[e].apov[t]=!0,o[e].teach[t]=l().props.auth.user.id}else o[e].apov[t]=!1}function se(e,t){o[e].apou[t]==!0?(o[e].apov[t]=!1,o[e].teach[t]=""):o[e].teach[t]=l().props.auth.user.id}return oe(()=>o.date,()=>ae.get(route("apousies",{t:r.selectedTmima,d:o.date}))),(e,t)=>(v(),g(I,null,[d(m(le),{title:"Απουσιολόγος"}),d(ue,null,{default:H(()=>[d(pe,{property:"saveSuccess"},{default:H(()=>[C(b(K()),1)]),_:1}),d(me,{property:"saveError"}),d(L,{property:"dateOutOfRange"}),d(L,{property:"checkUpdates",html:!0}),t[12]||(t[12]=a("div",{class:"px-4 pt-4 w-full max-w-7xl mx-auto"},[a("div",{class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},[a("div",{class:"p-6 bg-white border-b border-gray-200 flex justify-between"},[a("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Απουσιολόγος ")])])],-1)),a("div",null,[a("div",Te,[a("div",$e,[a("div",Ae,[a("div",Se,[t[5]||(t[5]=a("span",{class:"pr-4 font-medium"},"Επιλογή τμήματος:",-1)),(v(!0),g(I,null,U(e.anatheseis,s=>(v(),ie(m(E),{key:s,href:e.route("apousies",{t:s,d:e.date}),class:$(["mr-2",{"bg-gray-500 text-gray-100 font-bold px-2 rounded-md":e.selectedTmima===s}]),title:"Επιλογή "+s},{default:H(()=>[C(b(s),1)]),_:2},1032,["href","class","title"]))),128)),i(d(m(E),{href:e.route("apousies",{t:"0",d:e.date}),class:$(["text-xl",{"bg-gray-500 text-gray-100 px-2 rounded-md font-bold":e.selectedTmima==="0"}]),title:"Αποεπιλογή τμήματος"},{default:H(()=>t[4]||(t[4]=[C("☒")])),_:1},8,["href","class"]),[[n,e.$page.props.auth.user.permissions.admin]])]),a("div",He,[d(ce,{type:"date",modelValue:m(o).date,"onUpdate:modelValue":t[0]||(t[0]=s=>m(o).date=s),disabled:Z(),class:"p-1 w-35 text-center"},null,8,["modelValue","disabled"]),i(a("a",{href:e.route("exportApouxls",{apoDate:m(o).date,eosDate:m(o).date}),title:"Εξαγωγή xls",class:"text-2xl"}," 📥 ",8,Ce),[[n,e.$page.props.auth.user.permissions.admin]])]),i(a("div",xe," Όχι απουσίες το Σαββατοκύριακο! ",512),[[n,!y.value]]),a("div",Ie,[d(M,{canSave:h.value,canUnlockHours:_.value,checkIfInProgram:S.value,selectedTmima:e.selectedTmima,showTitleAndButtons:f.value,checkIfAllowWeekends:y.value,onUnlockHours:t[1]||(t[1]=s=>p.value=1),onApouSubmit:N,class:"pt-4"},null,8,["canSave","canUnlockHours","checkIfInProgram","selectedTmima","showTitleAndButtons","checkIfAllowWeekends"]),i(a("div",_e," Επιλέξτε ένα τμήμα. ",512),[[n,!k.value&&!e.$page.props.auth.user.permissions.admin]]),i(a("div",Ue," Τι ωραία! Ούτε μία απουσία! ",512),[[n,!k.value&&e.$page.props.auth.user.permissions.admin]]),i(a("div",Ee,[a("div",Pe,[t[6]||(t[6]=a("div",{class:"w-6 text-right"},null,-1)),i(a("div",Ve,"ΤΜ",512),[[n,x.value]]),t[7]||(t[7]=a("div",{class:"w-10 text-center"},"ΑΜ",-1)),t[8]||(t[8]=a("div",null,"ΟΝΟΜΑΤΕΠΩΝΥΜΟ",-1))]),i(a("div",Be,[t[10]||(t[10]=a("div",{class:"w-8 text-center pb-0.5 bg-gray-200 font-semibold"}," ∑ ",-1)),(v(!0),g(I,null,U(e.totalHours,s=>i((v(),g("div",{key:s,onClick:T=>G(s),class:$(["w-8 text-center pb-0.5 bg-gray-100 font-semibold",{"bg-gray-500 text-gray-100":s===e.activeHour,"cursor-pointer":p.value||s===e.activeHour}]),title:p.value||s==e.activeHour?"Επιλογή όλων":""},b(s)+"η ",11,De)),[[n,s<=e.activeHour||W.value]])),128)),i(a("div",{class:$(e.$page.props.auth.user.permissions.admin?"w-14 bg-gray-200 text-center":"w-8 bg-gray-200 text-center")},[i(d(m(E),{href:e.route("emailParent")+`/all/${e.date}/${e.selectedTmima}`+X(),class:"w-8 pb-0.5 font-semibold",title:"Email σε όλους",onclick:"return confirm('Να σταλεί email στους επιλεγμένους κηδεμόνες?\\n\\nΑν δεν επιλεγεί κανείς στέλνεται email σε όλους.\\n\\nΕπιβεβαιώστε παρακαλώ.');"},{default:H(()=>t[9]||(t[9]=[a("span",{class:"bg-blue-500 px-1 rounded"}," 📧",-1)])),_:1},8,["href"]),[[n,O.value]]),i(d(D,{onClick:t[2]||(t[2]=s=>Y(s.target)),class:"ml-1 mb-0.5",title:"Επιλογή όλων"},null,512),[[n,O.value]])],2),[[n,e.$page.props.auth.user.permissions.teacherOrAdmin]])],512),[[n,S.value&&y.value]])],512),[[n,k.value]]),(v(!0),g(I,null,U(e.arrStudents,(s,T)=>i((v(),g("div",{key:s.id,class:"pt-1 flex flex-col sm:flex-row sm:space-x-2"},[a("div",We,[a("div",Oe,b(T+1)+".",1),i(a("div",{class:"w-6 text-center overflow-hidden"},b(s.tmima),513),[[n,x.value]]),a("div",Ne,b(s.id),1),a("div",null,b(s.eponimo+" "+s.onoma),1)]),i(a("div",je,[a("div",{onClick:ne(u=>Q(s.id),["self"]),class:$(["w-8 text-center pb-0.5 bg-gray-200 font-semibold",{"cursor-pointer":e.$page.props.auth.user.permissions.admin}]),title:e.$page.props.auth.user.permissions.admin?"Επιλογή όλων":""},[C(b(s.apousies||" ")+" ",1),a("div",{class:"h-2 bg-gray-300 mt-0.5 ml-1 mr-1 cursor-pointer rounded",title:"Αποβολή",onClick:u=>J(s.id)},null,8,Me)],10,Fe),(v(!0),g(I,null,U(e.totalHours,u=>i((v(),g("div",{key:u,class:$(["w-8 text-center pb-0.5 bg-gray-100",{"bg-gray-500":u===e.activeHour,"bg-red-300":m(o)[s.id].apov[u]}])},[d(D,{modelValue:m(o)[s.id].apou[u],"onUpdate:modelValue":V=>m(o)[s.id].apou[u]=V,class:"bg-white",checked:m(o)[s.id].apou[u],disabled:j(s.id,u),title:e.arrNames[m(o)[s.id].teach[u]]!==void 0?e.arrNames[m(o)[s.id].teach[u]]:m(o)[s.id].teach[u]??"teacher_id "+m(o)[s.id].teach[u],onClick:V=>se(s.id,u)},null,8,["modelValue","onUpdate:modelValue","checked","disabled","title","onClick"]),a("div",{class:$(["h-2 bg-gray-300 mt-0.5 ml-1 mr-1 cursor-pointer rounded",{"bg-red-400":m(o)[s.id].apov[u],"bg-gray-700":u===e.activeHour}]),title:"Αποβολή",onClick:V=>ee(s.id,u)},null,10,Le)],2)),[[n,u<=e.activeHour||W.value]])),128)),i(a("div",{class:$(e.$page.props.auth.user.permissions.admin?"w-14 bg-gray-200 text-center":"w-8 bg-gray-200 text-center")},[i(d(m(E),{href:e.route("emailParent")+`/${s.id}/${e.date}`,class:"w-8 pb-0.5 font-semibold",title:"email σε "+s.eponimo+" "+s.onoma+" "+s.email,onclick:"return confirm('Αποστολή email?');"},{default:H(()=>t[11]||(t[11]=[a("span",{class:"bg-blue-500 px-1 rounded"},"📧",-1)])),_:2},1032,["href","title"]),[[n,z.value&&s.apousies&&s.email]]),i(d(D,{modelValue:c[s.id],"onUpdate:modelValue":u=>c[s.id]=u,checked:c[s.id],class:"ml-1 mb-0.5"},null,8,["modelValue","onUpdate:modelValue","checked"]),[[n,e.$page.props.auth.user.permissions.admin&&s.apousies&&s.email]])],2),[[n,e.$page.props.auth.user.permissions.teacherOrAdmin]])],512),[[n,S.value&&y.value]])])),[[n,k.value]])),128)),d(M,{canSave:h.value,canUnlockHours:_.value,checkIfInProgram:S.value,selectedTmima:e.selectedTmima,showTitleAndButtons:f.value,checkIfAllowWeekends:y.value,onUnlockHours:t[3]||(t[3]=s=>p.value=1),onApouSubmit:N,class:"pt-4"},null,8,["canSave","canUnlockHours","checkIfInProgram","selectedTmima","showTitleAndButtons","checkIfAllowWeekends"])])])])])])]),_:1})],64))}}),ss=R(qe,[["__scopeId","data-v-626bd288"]]);export{ss as default};
